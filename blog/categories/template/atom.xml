<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: template | DevOp's Blog]]></title>
  <link href="http://jakshi.github.com/blog/categories/template/atom.xml" rel="self"/>
  <link href="http://jakshi.github.com/"/>
  <updated>2015-06-11T14:21:33+08:00</updated>
  <id>http://jakshi.github.com/</id>
  <author>
    <name><![CDATA[jakshi]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Chef cookbook templating with cookiecutter]]></title>
    <link href="http://jakshi.github.com/blog/2014/05/03/chef-cookbook-templating-with-cookiecutter/"/>
    <updated>2014-05-03T01:21:00+08:00</updated>
    <id>http://jakshi.github.com/blog/2014/05/03/chef-cookbook-templating-with-cookiecutter</id>
    <content type="html"><![CDATA[<p>One of the challenges in chef cookbook development - create a comprehensive cookbook template.</p>

<p>Good cookbook template might:</p>

<ul>
<li>standartize your cookbooks</li>
<li>fill them with convenient predefinitions</li>
<li>save your time.</li>
</ul>


<p>If you are not python averse, you could find that <a href="https://github.com/audreyr/cookiecutter">cookiecutter</a> pretty useful tool for creating your cookbooks templates. This article describes my experience in creating chef cookbook template with <a href="https://github.com/audreyr/cookiecutter">cookiecutter</a>.</p>

<!-- more -->


<h1>Cookiecutter in nutshell</h1>

<ul>
<li><a href="https://github.com/audreyr/cookiecutter">cookiecutter</a> is a python based software.</li>
<li>it uses <a href="http://jinja.pocoo.org/">Jinja</a> templating engine</li>
<li>To install cookiecutter read: <a href="http://cookiecutter.readthedocs.org/en/latest/installation.html">Installing Cookiecutter</a>.</li>
<li>On my Ubuntu 12.04 workstation I used <code>pip cookiecutter</code> to install it.</li>
<li>variables defined in <code>cookiecutter.json</code> file in the root of template directories hierarchy</li>
<li>these variables might be used inside files by specifing <div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{{cookiecutter.variable_name}}</span></code></pre></td></tr></table></div></figure></notextile></div></li>
<li>these variables might be used as a file or directory names, if you call file or directory like: <div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{{cookiecutter.variable_name}}</span></code></pre></td></tr></table></div></figure></notextile></div></li>
<li>cookiecutter supports pre and post generate hooks.</li>
<li>hooks might be shell or python scripts, have names <code>pre_gen_project.[sh,py]</code> or <code>post_gen_project.[sh,py]</code>, and should be in hooks dir.</li>
</ul>


<h1>Chef cookbook templating with cookiecutter</h1>

<h2>Create a directory for template</h2>

<p><code>
mkdir chef-cookbook-template
cd chef-cookbook-template
</code></p>

<h2>Create a file with template variables</h2>

<p>```
emacs cookiecutter.json
{</p>

<pre><code> "author": "John Smith",
 "email": "cookbooks@example.com",
 "cookbook_name": "",
 "company_name": "Example Ltd",
 "release_date": "2014-04-17",
 "year": "2014",
 "version": "0.0.1"
</code></pre>

<p>}
```</p>

<p>Value that specified in this file, will be suggested as a default one.</p>

<p>As you see there's no value for "cookbook_name". So there will be no default value, you need to specify it every time you create new cookbook from this template.</p>

<h2>Create a templated directory for cookbook</h2>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir "chef-{{cookiecutter.cookbook_name}}"</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h2>Create files for your cookbook.</h2>

<p>On this stage you should fill your cookbooks with files that you need in your cookbook template. Use variables when it's suitable.</p>

<p>In my cookbook template I added variables to files:</p>

<ul>
<li>attributes/default.rb</li>
<li>README.md</li>
<li>spec/default_spec.rb</li>
<li>metadata.rb</li>
<li>{{cookiecutter.cookbook_name}}.packer</li>
<li>LICENSE</li>
<li>Vagrantfile</li>
<li>.kitchen.yml</li>
<li>test/integration/default/serverspec/localhost/default_spec.rb</li>
<li>recipes/default.rb</li>
</ul>


<h2>Post-create hooks</h2>

<p>It could be anything you want. For example I initialize my cookbook template with git.</p>

<p>In root directory of cookiecutter template add hooks directory.</p>

<p><code>
mkdir hooks
cd hooks
emacs post_gen_project.sh
</code></p>

<p>```</p>

<h1>!/bin/bash</h1>

<p>command -v git >/dev/null 2>&amp;1 &amp;&amp; git init || { echo >&amp;2 "git init is failed. Probably git is not installed. Install git if it's not installed."; exit 1; }
```</p>

<h1>Usage</h1>

<p>I presume that:</p>

<ul>
<li>you finished your template</li>
<li>and uploaded it to github</li>
</ul>


<h2>Use template from github git repository</h2>

<p><code>
cookiecutter https://github.com/example/my-chef-cookbook-template.git
</code></p>

<h2>Use it again.</h2>

<ul>
<li>After first usage template will be copied to ~/.cookiecutter directory.</li>
<li>So to use it again you need to specify template name only:</li>
</ul>


<p><code>
cookiecutter my-chef-cookbook-template
</code></p>

<h2>Update template</h2>

<p><code>
cd ~/.cookiecutter/my-chef-cookbook-template
git pull
</code></p>

<h2>Use template from local dir</h2>

<ul>
<li>You can just store template in current directory and use it.</li>
<li>Let's presume that you have template in <code>my-chef-cookbook-template</code> dir.</li>
<li>Then to use template you just need to execute command:</li>
</ul>


<p><code>
cookiecutter my-chef-cookbook-template
</code></p>

<h1>Tips and tricks</h1>

<ul>
<li>If you want to include in resulting file {{ or/and }}, you can specify them like <div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{{'{{'}}</span></code></pre></td></tr></table></div></figure></notextile></div> or/and <div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{{'}}'}}</span></code></pre></td></tr></table></div></figure></notextile></div></li>
</ul>


<h1>References</h1>

<ul>
<li><a href="https://github.com/audreyr/cookiecutter">Cookiecutter</a></li>
<li><a href="http://cookiecutter.readthedocs.org/en/latest/installation.html">Installing Cookiecutter</a></li>
<li><a href="http://jinja.pocoo.org/">Jinja</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
